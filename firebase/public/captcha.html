<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>Entering captcha</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
      .button {
        background-color: transparent;
        border: 1;
        border-width: 3px;
        border-color: #D3E5F9;
        color: black;
        padding: 10px 22px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
      }
    </style>
  </head>
  <body style="text-align: center;">
    <p style="text-align: center; font-size: 1.5em; margin-top: 30px;">자동가입 방지를 위한 절차 입니다<p/>
    <div id="captchaWrap" style="width: 100%; margin: 0 auto; text-align: center;">
    </div>
    <div style="width: 100%; margin: 10px; text-align:right;">
        <span id="continue-btn" style="display:none; font-size: 1.5em; text-decoration: underline; margin: 10px;color: #5392aa;" />앱으로 돌아가기</span>
    </div>
    <div style="text-align: right;">
      <checkbox id="confirmAuthBtn" type="button" class="confirmButton" onclick="confirmAuthByUser();">보안사항 확인하기(클릭)</button>
    </div>
    <div class="card" style="text-align: left;">
      <ul class="list-group list-group-flush">
        <li class="list-group-item" style="font-weight: bold; text-align: center;">이용약관 동의</li>
        <li class="list-group-item">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
            <label class="form-check-label" for="defaultCheck1">
              전체동의
            </label>
          </div>
        </li>
        <li>
          <div class="card-body">
            <div class="form-check" style="display: line-block;">
              <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
              <label class="form-check-label" for="defaultCheck1">
                Google 전화번호 인증(전화번호 변경시 중의, 탈퇴 필수)
              </label>
            </div>
            <a href="#" class="card-link" style="display: line-block;">내용 보기</a>
          </div>
        </li>
        <li>
          <div class="card-body">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
              <label class="form-check-label" for="defaultCheck1">
                이용약관
              </label>
            </div>
            <a href="#" class="card-link">내용 보기</a>
          </div>
        </li>
        <li>
            <div class="card-body">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                <label class="form-check-label" for="defaultCheck1">
                  개인정보약관
                </label>
              </div>
              <a href="#" class="card-link">내용 보기</a>
            </div>
          </li>
      </ul>
    </div>
    <div style="text-align: right; font-size: 0.9rem; overflow: auto; height:250px;">
        <p>안녕하세요, 장비콜 입니다.<p>
        <br>
        <p>저희는 Google에서 제공하는 Firebase 전화번호 인증을 통해 로그인을 하고 있습니다.</p>
        <p>전화번호 인증은 SMS 일회용 코드를 이용해 사용자 인증을 하고 있습니다.</p>
        <p>건설장비 이용 고객이 '장비 콜'을 이용하여 쉽게 장비를 호출하기 위한, 가장 효과적인 방법으로 판단하였습니다.</p>
        <p>추후 기능이 추가됨에 따라, 인증보안을 강화할 수 있습니다.</p>
        <p>또한 전화번호 소유권은 사용자 간에 쉽게 이전될 수 있으므로, 전화번호가 바뀔경우 '장비콜 문의'로 변경 부탁 드립니다.</p>
        <p>탈퇴시 꼭! 탈퇴하기 메뉴을 이용해 주시기 바랍니다.</p>
    </div>
    <div style="width: 100%; bottom: 50px;">
        <img style="width: 100px; height:100px;" src="https://s3.ap-northeast-2.amazonaws.com/elasticbeanstalk-ap-northeast-2-499435767786/asset/img/icon-jangbee_400.png" />
    </div>
    <script src="/__/firebase/5.3.1/firebase-app.js"></script>
    <script src="/__/firebase/5.3.1/firebase-auth.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script>
        function getToken(callback) {
            var container = document.createElement('div');
            container.id = 'captcha';
            container.style.textAlign = 'center';
            document.getElementById('captchaWrap').appendChild(container);
            var captcha = new firebase.auth.RecaptchaVerifier('captcha', {
                'size': 'normal',
                'callback': function(token) {
                    callback(token);
                },
                'expired-callback': function() {
                    callback('');
                }
            });
            captcha.render().then(function() {
                captcha.verify();
            });
        }

        function sendTokenToApp(token) {
            var baseUri = decodeURIComponent(location.search.replace(/^\?appurl\=/, ''));
            if (baseUri.indexOf(':1900/--/?') !== -1) { baseUri = baseUri.replace(':1900/--/?',':1900/?'); }
            const finalUrl = location.href =  baseUri+'token=' + encodeURIComponent(token);
            const continueBtn = document.querySelector('#continue-btn');
            continueBtn.onclick = (event)=>{
                window.open(finalUrl,'_blank')
            }
            continueBtn.style.display = "block";
        }

        function confirmAuthByUser() {
            document.getElementById("confirmAuthBtn").style.backgroundColor = '#D3E5F9';
            getToken(sendTokenToApp);
        }
        
    </script>
  </body>
</html>
